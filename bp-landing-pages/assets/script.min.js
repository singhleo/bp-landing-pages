jQuery(document).ready(function(a){BPFP_WIDGETS.richcontent.init(),BPFP_WIDGETS.groups_ui.init(),BPFP_WIDGETS.manage.init()}),BPFP_WIDGETS.manage={},function(a,b,c){var d={};a.getElements=function(){return d.available_widgets=c(".bpfp_available_widgets"),0!=d.available_widgets.length&&(d.added_widgets=c(".bpfp_added_widgets"),!0)},a.init=function(){c("body").hasClass("bp-user")&&c('input[name="_has_custom_frontpage"]').change(function(){a.toggleFPStatus(c(this))}),a.getElements()&&(d.available_widgets.find(".lnk_add_widget").click(function(b){b.preventDefault(),$clone=c(this).closest(".bpfp_widget").clone(),$clone.removeClass("preview").addClass("setting").addClass("expanded"),$clone.find(".lnk_add_widget").remove(),$clone.appendTo(d.added_widgets),c("html, body").animate({scrollTop:$clone.offset().top},1e3),d.added_widgets.find(".no_widgets_message").hide(),a.initWidget($clone)}),d.added_widgets.find(".bpfp_widget").each(function(){a.bindEvents(c(this)),c(document).trigger("bpfp_on_init",[c(this)])}),d.added_widgets.sortable({items:"> .bpfp_widget",handle:".widget_name",update:function(b,c){a.updateWidgetsOrder()}}))},a.initWidget=function(b){b.addClass("loading");var d={action:"bpfp_widget_init",type:b.data("type"),nonce:BPFP_WIDGETS.config.nonce.init};c.ajax({type:"POST",url:ajaxurl,data:d,success:function(d){d=c.parseJSON(d),d.status?($new_widget=c(d.html),b.replaceWith($new_widget),a.bindEvents($new_widget),c(document).trigger("bpfp_on_init",[$new_widget])):d.message&&alert(d.message),d.newnonce&&(BPFP_WIDGETS.config.nonce.init=d.newnonce)}})},a.bindEvents=function(b){b.find(".lnk_toggle_widget_details").click(function(a){a.preventDefault(),b.toggleClass("expanded").toggleClass("collapsed"),b.find(".widget_description").slideToggle()}),a.handleDelete(b),a.handleUpdate(b)},a.handleDelete=function(a){a.find(".lnk_delete_widget").click(function(b){if(b.preventDefault(),confirm(BPFP_WIDGETS.translations.confirm_delete)){var e={action:"bpfp_widget_delete",id:a.find('[name="widget_id"]').val(),nonce:BPFP_WIDGETS.config.nonce.delete};c.ajax({type:"POST",url:ajaxurl,data:e,success:function(a){a=c.parseJSON(a),a.newnonce&&(BPFP_WIDGETS.config.nonce.delete=a.newnonce)}}),a.slideUp(500,function(){a.remove(),d.added_widgets.find(".bpfp_widget").length<1&&d.added_widgets.find(".no_widgets_message").show()})}})},a.handleUpdate=function(b){$form=b.find("form");var d={beforeSerialize:function(){},beforeSubmit:function(){b.find(".response").remove(),b.addClass("loading")},success:function(d,e){d=c.parseJSON(d),d.status?($new_widget=c(d.html),$new_widget.addClass("loading"),b.replaceWith($new_widget),a.bindEvents($new_widget),c(document).trigger("bpfp_on_init",[$new_widget]),$loading_overlay=$new_widget.find(".loading_overlay"),$loading_overlay.find(".img_loading").hide(),$loading_overlay.find(".img_success").show(),t=setTimeout(function(){$new_widget.removeClass("loading"),$loading_overlay.find(".img_loading").show(),$loading_overlay.find(".img_success").hide(),$new_widget.find("form").append("<div class='response alert alert-success'>"+d.message+"</div>")},2e3)):($form.append("<div class='response alert alert-error'>"+d.message+"</div>"),b.removeClass("loading"))}};$form.ajaxForm(d)},a.updateWidgetsOrder=function(){var a=[],b="";if(c(d.added_widgets.find(".bpfp_widget")).each(function(){a.push(c(this).find('form [name="widget_id"]').val())}),!(a.length>0))return!1;b=a.join(",");var e={action:"bpfp_widgets_reorder",ids:b,nonce:BPFP_WIDGETS.config.nonce.reorder};c.ajax({type:"POST",url:ajaxurl,data:e,success:function(a){}})},a.toggleFPStatus=function(a){var b=0;a.is(":checked")&&(b=1),b?c(".hcfp_dependent").show():c(".hcfp_dependent").hide();var d={action:"bpfp_change_status",updated_status:b,nonce:BPFP_WIDGETS.config.nonce.change_status};c.ajax({type:"POST",url:ajaxurl,data:d,success:function(a){a=c.parseJSON(a),a.newnonce&&(BPFP_WIDGETS.config.nonce.change_status=a.newnonce)}})},a.initGroupWidgetsUI=function(){}}(BPFP_WIDGETS.manage,window,window.jQuery),BPFP_WIDGETS.richcontent={},function(a,b,c){a.init=function(){c(document).on("bpfp_on_init",function(a,b){"richcontent"==b.find('[name="widget_type"]').val()&&b.find("textarea").trumbowyg()})}}(BPFP_WIDGETS.richcontent,window,window.jQuery),BPFP_WIDGETS.groups_ui={},function(a,b,c){a.init=function(){if(c("body").hasClass("single-item")&&c("body").hasClass("groups")&&c("#bpfp_widgets_ui_wrapper").length>0)return a.initGroupWidgetsUI(),!1},a.initGroupWidgetsUI=function(){var a=c("#bpfp_widgets_ui_wrapper"),b=a.closest("form");b.after(a);var d={action:BPFP_WIDGETS.config.action.init_group,nonce:BPFP_WIDGETS.config.nonce.init_group};c.ajax({url:ajaxurl,method:"POST",data:d,success:function(b){a.find("#bpfp_widgets_ui").html(b),a.removeClass("loading"),BPFP_WIDGETS.manage.init()}})}}(BPFP_WIDGETS.groups_ui,window,window.jQuery);